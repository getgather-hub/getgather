name: Caesars

auth:
  fields:
    - name: email
      type: text
      prompt: Email, Mobile, Caesars Rewards \#
      selector: input[type=text][aria-label="Email, Mobile, Caesars Rewards \#"]
    - name: password
      type: password
      prompt: Password
      selector: input[type=password]
    - name: submit
      type: click
      prompt: Submit
      selector: button:has-text("SIGN IN"), div[role="button"][data-testid="submit-sign-in-button"]
      expect_nav: true
      delay_ms: 6000
    - name: skip_phone
      type: click
      prompt: Skip
      selector: button:has-text("Maybe Later")
      expect_nav: true
    - name: incorrect_credentials_error
      type: message
      selector: div:has-text("Invalid username or password. Please try again.")
      prompt: ‚ùå Invalid username or password. Please try again.
    - name: logged_in_homepage
      type: wait
      selector: a:has-text("Sign Out")
  pages:
    - name: Go to Caesars website
      fields:
        required: [email, password, submit]
        optional: [incorrect_credentials_error]

    - name: Skip phone verification
      fields: [skip_phone]
      # Another way to do this would be to monitor for this URL: https://www.caesars.com/a/verification/?forwardUrl=%2frewards%2fHome
      # and then navigate straight to the home page.

    - name: Home page
      fields: [logged_in_homepage]
      end: true
  start: https://www.caesars.com/myrewards/profile/signin
extract:  # can't be spun up again after auth for some reason, reauthentication is always required at this point
  steps:
    - name: Go to the order history
      url: https://www.caesars.com/rewards/stays

    - name: Wait for the loading
      timeout: 5
      wait_for_selector: a[data-testid=past]

    - name: Go to past stays
      click: a[data-testid=past]

    - name: Extract the list of past stays
      bundle: past-stays.html
      slurp_selector: div[data-testid="Property-value-label"]
